var mongoose = require('mongoose');
var Schema = mongoose.Schema;
var debug = require('debug')('appreports:audit');
var nowAsDate = require('app/date').nowAsDate;

var schema = new Schema({
  storeId: String,
  created: Date,
  data: Object
});

schema.statics.addLog = function(log, done) {
  if(!log) {
    if(typeof done === 'function') {
      done();
    }

    return;
  }

  log.created = nowAsDate();
  debug('audit log', log);
  this.create(log, done);
}

module.exports = mongoose.model('AuditLog', schema);
