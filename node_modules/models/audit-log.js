var mongoose = require('mongoose');
var Schema = mongoose.Schema;
var debug = require('debug')('appreports:audit');
var nowAsDate = require('app/date').nowAsDate;

var schema = new Schema({
  storeId: { type: String, required: true, index: true },
  created: { type: Date, default: nowAsDate, index: true },
  region: String,
  field: { type: String, required: true, index: true },
  oldValue: { type: String, required: false },
  newValue: { type: String, required: true }
}, { autoIndex: process.env.MONGO_AUTOINDEX || false });

schema.statics.addLog = function(audit, done) {
  debug('audit log', audit);
  this.create(audit, done);
}

module.exports = mongoose.model('Audit', schema);
